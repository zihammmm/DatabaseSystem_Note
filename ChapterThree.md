# 关系数据库系统

## 关系数据库系统概述
关系数据库系统的优点
+ 数据结构简单
+ 使用方便
  + 不涉及系统的内部物理结构
  + 非过程性数据子语言
+ 功能强
  + 模型表达能力强，具有一定的模型修改功能
  + 可方便的修改数据间的联系
  + 可灵活选择数据存取路径
  + 高级的数据操纵语言
+ 数据独立性高
  + 数据的逻辑结构不涉及物理因素
  + 操作的非过程性
+ 理论基础深 
+ 可移植性好
+ 标准化程度高
+ 分布式功能
+ 开放性
+ 其他方面的功能扩展

## 关系数据库系统衡量准则
+ 初期的'六条准则'
    + 提供高度的数据独立性
    + 提供严格的数据视图
    + 减轻DBA的工作
    + 建立理论基础
    + 事物管理与文件管理的结合
    + 操作对象是记录集合
+ 完全关系型的12条严格标准
    + 信息准则：所有信息用表中的元组或元组中的属性值来表示
    + 确保访问准则：应能保证用逻辑方式依靠表名，关键字值与列名的组合来访问每一个原子数据
    + 空值的关系处理准则
      + 空值：无意义或当前未知的值
      + 系统应该具有处理空值的能力
          + 空值的比较运算
          + 含有空值运算对象的表达式计算
          + 含有空值成员的集合上的统计运算
    + 基于资源管理的动态联机目录
    + 统一易用的数据子语言
      + 数据定义
      + 视图定义
      + 数据操纵
      + 完整性约束能力
      + 授权机制
      + 事物处理能力
    + 视图更新准则
    + 高级的插入、删除及修改操作
    + 物理数据独立性
    + 逻辑数据独立性
    + 数据完整性准则
    + 分布独立性
    + 无损害原则

+ 关系数据库产品的分类
  + 半关系型系统：满足12条准则中的少量要求
  + 基本关系型系统：满足12条准则中的大部分要求
  + 完全关系型系统：严格符合上述的12条准则

## 关系模型数学理论-关系代数
### 关系模型
+ 关系数据结构
  + 表结构
    - 表框架：n个属性构成(n元表)，每个属性有一个取值范围(值域)
    - 元组
  + 键(最小的superkey)
    - 主键
      * 唯一最小标识元组的属性集
      * 每张二维表至少存在一个'键'
    - 外键
      - 外键直接引用其自身表中的元组(取空或者取已存在的元组)
  + 关系
    - 二维表的性质(满足7个性质的二维表叫关系)
        > 元组个数有限性  
        > 元组的唯一性  
        > 元组的次序无关性  
        > 元组分量的原子性  
        > 属性名唯一性  
        > 属性的次序无关性  
        > 分量值域同一性  
  + 关系规则：
    - 第一范式：不能包含多值的域
    - 仅按内容访问行
    - 唯一行

名词术语之间的对应关系
![](/images/3.3.0.0.png)

+ 关系操纵  
建立在关系上的数据操纵功能  
  - 查询
    > 可分解为：  
    > 两个关系的合并  
    > 单个关系内的元组选择  
    > 单个关系内的属性指定  
    * 单张表内的数据查询
    > 纵向定位(选择满足某些逻辑条件的元组)，横向定位(指定关系中的一些属性)
    * 两张表之间的数据查询
    > 先将两张表合并为一张表  
    > 再了利用单张表内的数据查询操作进行查询
    * 多张表上的数据查询
    > 先将多张表合并为一张表  
    > 再利用单张表内的数据查询操作进行查询 
  - 增加
    * 一条操作只能向一个关系中增加新的元组
  - 删除(基本单位是元组)
    * 确定被删除的元组：只能删除一个关系内的元组，利用单个关系内的元组选择操作来确定 
    * 执行删除操作 
  - 修改
    * 在一个关系内修改指定元组的某些列上的值 
    * 由其他数据操纵方式来实现
      > 先删除需要修改的元组  
      > 然后插入修改后的新元组  

  - 空值处理  
    - 关系的主键中不允许出现空值
    - 有关空值的运算
      * 在算数表达式中如出现空值，运算结果也为空值
      * 在逻辑运算表达式中如出现空值，其运算结果为逻辑假
      * 统计计算中，对于'空集'和集合中的'空值'的处理方法  
        > SUM,AVG,MAX,MIN,COUNT,集合中的空值不统计在内  
        > 对空集作SUM,AVG,MAX,MIN，其统计结果均为空值  
        > 对空集作COUNT，统计结果为0  
      
  - 三类数据完整性约束
    * 实体完整性约束:主键中的属性不能为空值
    * 参照完整性约束:外键要么取空值，要么是被引用表中当前存在的某元组上的主键值  
    * 用户定义的完整性：用户自己定义的属性取值约束

### 关系表示
关系是元组的集合，元组是元组分量的集合。  
n元关系(属性)  
一个n元关系就是一个n元有序组的集合  
+ 笛卡尔乘积  
 - 存在n个集合$D_{1},D_{2}...D_{n}$,它们的笛卡尔乘积是$D_{1}*D_{2}*D_{3}*...*D_{n}$(也是一个集合) 
 - 设集合$D_{i}$的元素个数为$r_{i}$，则它们的笛卡尔乘积的结果元素个数为:
$$ r_{1}*r_{2}*...*r_{n}$$
+ 关系R 
n元关系R是一个n元有序组的集合。  
n元关系R的属性域分别是$D_{1},D_{2}...D_{n}$，n个域的笛卡尔乘积也是一个n元有序组的集合
并且与n元关系R存在如下联系：  
$R \subseteq D_{1}*D_{2}*...*D_{n}$

### 关系操纵的表示
四种类型的数据操纵功能可以被分解为关系模型上的五种基本操作    
![](/images/3.3.2.0.png)

+ 运算的执行条件
  - 相容表：有相同的表头(**属性都取自相同的值域，并且有相同的含义(列的名字相同，与顺序无关)**)
  - 并，交，差：前提是相容表  
  - 并，交有交换律与结合律，差运算没有。
    * $R \cap S = R - (R - S) = S - (S - R)$
    * $(R - S) \cap S = \emptyset$
    * $(R - S) \cap R = R - S$
    * $(R - S) \cap (S - R) = \emptyset$

+ 运算的执行结果
  - 结果关系的关系模式
  - 结果关系中的元组

+ 并运算：
    > 参与运算的两个关系必须是同类关系(具有相同的属性个数，对应的列所表示的属性具有相同的值域),结果：关系模式不变
+ 差运算：
  > 参与运算的两个关系必须是同类关系。结果：关系模式不变   

### 关系模型与关系代数
+ 投影运算：略去关系中的某些列并重新安排剩余列的排列次序的运算
  - 设关系R有n个属性A1,A2,A3...AN，在其中m个属性B1,B2,..BM上的投影运算可以表示为：
  $$ \Pi_{B_{1}B_{2},...,B_{m}}(R) $$  
  其中：$R_{i} \in {A_{1},A_{2},..,A_{n}}(i=1,2,..,m)$
  - 运算结果是一个由$B_{1},B_{2},...,B_{m}$所组成的**m元关系**
  - 关系R中的每个元组t在这m个属性上的取值也构成结果关系中的一个元组  
  - 必须消除结果关系中可能出现的重复元组
  - 不满足交换律

+ 选择运算:$\sigma_{F}(R)$  
  - 根据给定的条件F从关系R中选出符合条件的元组
  - 结果：结果关系的关系模式不变，由属于关系R且满足条件F的**元组**所组成
  - 条件F的构造
    * 基本逻辑条件:$\alpha \theta \beta$  
    * 复合逻辑条件:$\land  \lor$
  - 取值要加引号
  ![](images/3.3.2.1.png)  
  - 满足交换律：查询优化

+ 可以结合使用投影和选择运算来实现单张表中的数据查询操作:$\Pi_{A}(\sigma_{F}(R))$**(先行后列)**
  - 先根据条件F对关系R进行选择运算
  - 再对选择运算的结果关系进行投影运算
  - 可以简写为:$\Pi_{A}\sigma_{F}(R)$，没有括号运算顺序为*从右向左*  ，两个运算的书写次序不能颠倒 

+ 关系的笛卡尔乘积：$R*S$  
  - 两个关系的合并运算  
  - R和S分别有n和m个属性，则笛卡尔乘积有n+m个属性
  - R和S分别有p和q个元组，则笛卡尔乘积就含有p*q个元组
  ![](images/3.3.2.2.png)
  
不会出现同样名字的列
  - 满足交换律和结合律
  - R和S存在先沟通的属性名，必须在结果关系中对其中的一个进行换名  

+ 关系数据库中的四种类型的操作，均可以用关系代数表达式来表示  
  - 元组插入
    > 设新增加的元组构成关系R',则插入操作:$R\cup R'$
  - 元组删除
    > 设欲删除的元组构成关系R'，则删除操作可表示为：$R-R'$
  - 修改操作
    > 欲修改的元组构成关系R'，修改后生成的新远古构成关系R''，则修改操作可表示为:$(R-R')\cup R''$
  - 查询操作
    * 单个操作:选择+投影
    * 多个关系：先用笛卡尔乘积将多个关系合并为一个关系，然后再执行单个关系上的数据查询操作  

例：求最大折扣
![](/images/3.3.2.3.png)
### 关系代数中的扩充运算
+ 交运算
  - 条件：同类关系
  - 结果：关系模式不变
+ 除运算:$R \div S$
  - 运算条件：$Head(S) \subset Head(R)$
    $Head(R) = {A_{1},A_{2},...,A_{n},B_{1},B_{2},...,B_{m}}$  
    $Head(S)={B_{1},B_{2},...,B_{m}}$  
    其中：S被称为"除数关系",R被称为"被除数关系",结果关系被称为"商"
  - 结果关系($T=R \div S$)
    * 关系模式：$Head(T)=Head(R)-Head(S)={A_{1},A_{2},...,A_{n}}$
    * 结果元素：S中所有元组在R中所对应的同一个值
  - 与笛卡尔乘积的关系
    * 如果$R=T * S$,$T=R\div S$,$S=R \div T$  
    * 如果$T=R\div S$, $T * S \subseteq R$ 
  - 与基本关系运算的关系 
    > IF $Head(R)={A_{1},..,A_{n},B_{1},...,B_{n}}$ $Head(S)={B_{1},..,B_{m}}$  
    > $R \div S = \Pi_{A_{1},..,A_{n}}(R)-\Pi_{A_{1},...,A_{n}}((\Pi_{A_{1},..,A_{n}}(R)*S)-R)$
+ 联接运算($\theta$-联接运算，可以将关系R和关系S根据联接条件F合并为一个关系)
  - 设结果关系为T，$Head(T) = Head(R) \$,**不必消除它们之间的同名属性**  
  - 构造方式:$R \Join_{F} S$
    * 基本条件:$i \theta j$  
      > i是关系R中的属性，j是关系S中的属性，$\theta$是比较运算符(大于联接，小于联接，等值联接)  
    * 有若干个基本条件经$\land$$\lor$连接而成的复杂条件
  - 推导公式:$R\Join_{F} S = \sigma_{F}(R*S)$ 
  - 联接运算与笛卡尔乘积运算的关系
    > 设$T_{1}=R*S, T_{2}=R\Join_{F}S$,则$Head(T_{2})=Head(T_{1})，且T_{2}\subseteq T_{1}$ 
+ 自然联接运算：$R\bowtie S$
  - 功能：根据两个关系中的同名属性(公共属性)进行等值联接。
  - 运算条件：
    * 关系R和关系S有公共属性：$Head(R) \cap Head(S) \neq \emptyset$
  - 运算结果:结果关系的属性集合为$Head(R)\cup Head(S)$
  - 结果关系中的元组:同名属性上的取值在结果关系中只保留一份
  - 推导公式:
    > 设$R={A_{1},A_{2},...,A_{n}},S={B_{1},B_{2},..,B_{n}}$,它们之间的公共属性为$A_{1},..,A_{j}$与$B_{1},B_{2},..,B_{j}$  
    > $B\bowtie S=\Pi_{A_{1},A_{2},..,A_{n},B_{j+1},..,B_{m}}(\sigma_{A_{1}=B_{1}\land A_{2}=B_{2}\land ...\land A_{j}=B_{j}}(R*S))$  

![](\images\3.3.2.4.png)
+ 其他联接运算  
  - 外联接:$R⟗S$
  - 左外联接:$R⟖S$
  - 右外联接:$R⟕S$
### 关系代数实例
求解过程:
+ 确定查询目标
+ 确定查询条件
+ 选择从条件到目标的查找路径，并据此确定操作对象
+ 关系的合并
+ 元组的选择
+ 属性的指定

## 关系数据库语言SQL'92
